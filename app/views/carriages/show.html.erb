<% provide(:title, "Edit") %>
<% if current_user.role == "user" %>
  <h2 style="text-align: center">Pick place that you want to order</h2>
  <br>
  <h2 style="text-align: center">Currently picked place: <span id='picked-place-span'>-</span></h2>
<% end %>
<% if @carriage.carriage_type.name == 'First-class' %>
  <%= render partial: 'carriages/partials/passenger-carriage', locals: { car_type: :coupe,
                                                                         seats: @carriage.seats,
                                                                         per_row: 4,
                                                                         per_upper_row: 4,
                                                                         per_bottom_row: 0} %>
<% elsif @carriage.carriage_type.name == 'Second-class' %>
  <%= render partial: 'carriages/partials/passenger-carriage', locals: { car_type: :plac,
                                                                         seats: @carriage.seats,
                                                                         per_row: 6,
                                                                         per_upper_row: 4,
                                                                         per_bottom_row: 2} %>
<% end %>

<div style="display: block; margin: 15px auto"><button style="position:absolute; bottom: 500px" id="confirm-seat-button" class="btn btn-success" onclick="confirmOrder()">Confirm</button></div>

<script>
  var chosen = "-"

  window.onload = function()
  {
      if (chosen==="-")
          document.querySelector('#confirm-seat-button').disabled = true
  }

  function pickSeat(item)
  {
      if (chosen === item.value)
      {
          chosen = "-"
          document.querySelector('#confirm-seat-button').disabled = true
      }
      else
      {
          chosen = item.value
          document.querySelector('#confirm-seat-button').disabled = false
      }
      document.querySelector('#picked-place-span').innerHTML = item.innerText
      console.log(chosen)
  }

  function confirmOrder()
  {
      if (chosen !== "-")
      {
          $.ajax(
              {
                  method: 'POST',
                  url: '/tickets',
                  data: { "authenticity_token" : "<%= form_authenticity_token %>", ticket: { user_id: <%= current_user.id %>, seat_id: chosen } }
              }
          )
      }
  }
</script>